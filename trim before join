# Trim using fastq-mcf in QIIME 1.80
for i in rawdata/*L001*; do fastq-mcf -k 0 -l 130 -q 25 -w 10 -o ${i/%.fastq/_trim25.fastq} n/a ${i}; done

# Move the R1 and R2 files to a new folder "trim"
mkdir trim
mv *trim25* trim
cd trim

# Get a list of all of the sample names
ls *.fastq | awk -F '_L001' '{print $1'} | uniq > sample_names.txt

# Synchronizing reads in R1 & R2 files
while read p; do perl ../resync --fwd=''"$p"'_L001_R1_001_trim25.fastq' -rev=''"$p"'_L001_R2_001_trim25.fastq'; done < sample_names.txt

# Move the sync read files to a new folder "sync" 
mkdir sync
mv *sync.fastq sync
cd sync

# import the paired-end fastq files into QIIME 2 #
qiime tools import --type 'SampleData[PairedEndSequencesWithQuality]' --input-path manifest --output-path trimmed.qza --source-format PairedEndFastqManifestPhred33
qiime demux summarize --i-data trimmed.qza --o-visualization trimmed.qzv

# join the reads (allow 3 mismatches for at least 10 bp overlap) #
qiime vsearch join-pairs --i-demultiplexed-seqs trimmed.qza --p-minovlen 10 --p-maxdiffs 3 --o-joined-sequences joined-3mismatch.qza
qiime demux summarize --i-data joined-3mismatch.qza --o-visualization joined-3mismatch.qzv
qiime tools view joined-3mismatch.qzv



